{"ast":null,"code":"import Dexie from 'dexie';\nconst db = new Dexie('MoneyTrackerDB');\ndb.version(1).stores({\n  transactions: '++id, type, amount, category, date, description',\n  categories: '++id, type, name'\n});\nexport const TRANSACTION_TYPES = {\n  INCOME: '收入',\n  EXPENSE: '支出'\n};\nexport const DEFAULT_INCOME_CATEGORIES = ['工资', '奖金', '投资收益', '兼职', '礼金', '报销', '其他收入'];\nexport const DEFAULT_EXPENSE_CATEGORIES = ['饮食', '住房', '交通', '购物', '娱乐', '医疗', '教育', '旅游', '数码', '生活用品', '其他支出'];\nexport const initCategories = async () => {\n  const count = await db.categories.count();\n  if (count === 0) {\n    const categoriesToAdd = [...DEFAULT_INCOME_CATEGORIES.map(name => ({\n      type: TRANSACTION_TYPES.INCOME,\n      name\n    })), ...DEFAULT_EXPENSE_CATEGORIES.map(name => ({\n      type: TRANSACTION_TYPES.EXPENSE,\n      name\n    }))];\n    await db.categories.bulkAdd(categoriesToAdd);\n  }\n};\ninitCategories();\nexport const getAllCategories = () => db.categories.toArray();\nexport const getCategoriesByType = type => db.categories.where('type').equals(type).toArray();\nexport const addCategory = category => db.categories.add(category);\nexport const updateCategory = (id, name) => db.categories.update(id, {\n  name\n});\nexport const deleteCategory = async id => {\n  const categoryToDelete = await db.categories.get(id);\n  if (!categoryToDelete) {\n    console.warn(`Category with id ${id} not found, cannot delete.`);\n    return; // Or throw an error if you prefer\n  }\n  const transactionCount = await db.transactions.where('category').equals(categoryToDelete.name).count();\n  if (transactionCount > 0) {\n    throw new Error('此类别已被使用，无法删除');\n  }\n  return db.categories.delete(id);\n};\nexport const addTransaction = transaction => {\n  if (typeof transaction.date === 'string') {\n    transaction.date = new Date(transaction.date);\n  }\n  return db.transactions.add(transaction);\n};\nexport const updateTransaction = (id, changes) => {\n  if (changes.date && typeof changes.date === 'string') {\n    changes.date = new Date(changes.date);\n  }\n  return db.transactions.update(id, changes);\n};\nexport const deleteTransaction = id => db.transactions.delete(id);\nexport const getAllTransactions = () => db.transactions.toArray();\nexport const getTransactionsByType = type => db.transactions.where('type').equals(type).toArray();\nexport const getTransactionsByDateRange = (startDate, endDate) => {\n  return db.transactions.where('date').between(startDate, endDate).toArray();\n};\nexport const getTransactionById = id => db.transactions.get(id);\nexport default db;","map":{"version":3,"names":["Dexie","db","version","stores","transactions","categories","TRANSACTION_TYPES","INCOME","EXPENSE","DEFAULT_INCOME_CATEGORIES","DEFAULT_EXPENSE_CATEGORIES","initCategories","count","categoriesToAdd","map","name","type","bulkAdd","getAllCategories","toArray","getCategoriesByType","where","equals","addCategory","category","add","updateCategory","id","update","deleteCategory","categoryToDelete","get","console","warn","transactionCount","Error","delete","addTransaction","transaction","date","Date","updateTransaction","changes","deleteTransaction","getAllTransactions","getTransactionsByType","getTransactionsByDateRange","startDate","endDate","between","getTransactionById"],"sources":["D:/money-tracker/src/db.js"],"sourcesContent":["import Dexie from 'dexie';\r\n\r\nconst db = new Dexie('MoneyTrackerDB');\r\n\r\ndb.version(1).stores({\r\n  transactions: '++id, type, amount, category, date, description',\r\n  categories: '++id, type, name'\r\n});\r\n\r\nexport const TRANSACTION_TYPES = {\r\n  INCOME: '收入',\r\n  EXPENSE: '支出'\r\n};\r\n\r\nexport const DEFAULT_INCOME_CATEGORIES = [\r\n  '工资', '奖金', '投资收益', '兼职', '礼金', '报销', '其他收入'\r\n];\r\n\r\nexport const DEFAULT_EXPENSE_CATEGORIES = [\r\n  '饮食', '住房', '交通', '购物', '娱乐', '医疗', '教育',\r\n  '旅游', '数码', '生活用品', '其他支出'\r\n];\r\n\r\nexport const initCategories = async () => {\r\n  const count = await db.categories.count();\r\n  if (count === 0) {\r\n    const categoriesToAdd = [\r\n      ...DEFAULT_INCOME_CATEGORIES.map(name => ({ type: TRANSACTION_TYPES.INCOME, name })),\r\n      ...DEFAULT_EXPENSE_CATEGORIES.map(name => ({ type: TRANSACTION_TYPES.EXPENSE, name }))\r\n    ];\r\n    await db.categories.bulkAdd(categoriesToAdd);\r\n  }\r\n};\r\n\r\ninitCategories();\r\n\r\nexport const getAllCategories = () => db.categories.toArray();\r\nexport const getCategoriesByType = (type) => db.categories.where('type').equals(type).toArray();\r\nexport const addCategory = (category) => db.categories.add(category);\r\nexport const updateCategory = (id, name) => db.categories.update(id, { name });\r\n\r\nexport const deleteCategory = async (id) => {\r\n  const categoryToDelete = await db.categories.get(id);\r\n  if (!categoryToDelete) {\r\n    console.warn(`Category with id ${id} not found, cannot delete.`);\r\n    return; // Or throw an error if you prefer\r\n  }\r\n  \r\n  const transactionCount = await db.transactions\r\n    .where('category').equals(categoryToDelete.name)\r\n    .count();\r\n  \r\n  if (transactionCount > 0) {\r\n    throw new Error('此类别已被使用，无法删除');\r\n  }\r\n  \r\n  return db.categories.delete(id);\r\n};\r\n\r\nexport const addTransaction = (transaction) => {\r\n  if (typeof transaction.date === 'string') {\r\n    transaction.date = new Date(transaction.date);\r\n  }\r\n  return db.transactions.add(transaction);\r\n};\r\n\r\nexport const updateTransaction = (id, changes) => {\r\n  if (changes.date && typeof changes.date === 'string') {\r\n    changes.date = new Date(changes.date);\r\n  }\r\n  return db.transactions.update(id, changes);\r\n};\r\n\r\nexport const deleteTransaction = (id) => db.transactions.delete(id);\r\nexport const getAllTransactions = () => db.transactions.toArray();\r\nexport const getTransactionsByType = (type) => db.transactions.where('type').equals(type).toArray();\r\nexport const getTransactionsByDateRange = (startDate, endDate) => {\r\n  return db.transactions.where('date').between(startDate, endDate).toArray();\r\n};\r\nexport const getTransactionById = (id) => db.transactions.get(id);\r\n\r\nexport default db; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}